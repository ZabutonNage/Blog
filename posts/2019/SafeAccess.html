<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Optional Chaining or SafeAccess for JavaScript | ZabutonNage Blog</title>
    <meta name="description" content="This post talks about implementing optional chaining with plain JavaScript. It gets beefed up with default values and safe function application through monadic structures for an extra smooth developer experience.">
    <link rel="icon" href="/favicon-zn.ico">
    <meta name="title" content="Optional Chaining or SafeAccess for JavaScript"><meta property="author" content="ZabutonNage"><meta name="keywords" content="functional javascript optional chaining safeaccess es6 proxy"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Optional Chaining or SafeAccess for JavaScript"><meta name="twitter:creator" content="@ZabutonNage"><meta name="twitter:description" content="This post talks about implementing optional chaining with plain JavaScript. It gets beefed up with default values and safe function application through monadic structures for an extra smooth developer experience."><meta name="twitter:image" content="https://www.zabutonnage.net/avtr.png"><meta property="og:title" content="Optional Chaining or SafeAccess for JavaScript"><meta property="og:type" content="article"><meta property="og:image" content="https://www.zabutonnage.net/avtr.png"><meta property="og:description" content="This post talks about implementing optional chaining with plain JavaScript. It gets beefed up with default values and safe function application through monadic structures for an extra smooth developer experience.">
    <link rel="preload" href="/assets/css/0.styles.1c87c9dc.css" as="style"><link rel="preload" href="/assets/js/app.92f3002a.js" as="script"><link rel="preload" href="/assets/js/2.3bc359b4.js" as="script"><link rel="preload" href="/assets/js/7.fcc56a48.js" as="script"><link rel="prefetch" href="/assets/js/10.5ec601f9.js"><link rel="prefetch" href="/assets/js/3.a3be8b28.js"><link rel="prefetch" href="/assets/js/4.2ab9221b.js"><link rel="prefetch" href="/assets/js/5.d79e2d2a.js"><link rel="prefetch" href="/assets/js/6.d8d124cf.js"><link rel="prefetch" href="/assets/js/8.8fcce053.js"><link rel="prefetch" href="/assets/js/9.bc647d22.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c87c9dc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ZabutonNage Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="https://github.com/ZabutonNage" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://twitter.com/ZabutonNage" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="https://github.com/ZabutonNage" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://twitter.com/ZabutonNage" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/posts/2020/Backticks.html" class="sidebar-link">One Tick To Rule Them All</a></li><li><a href="/posts/2019/SafeAccess.html" class="active sidebar-link">SafeAccess</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/posts/2019/SafeAccess.html#what-this-is-about" class="sidebar-link">What this is about</a></li><li class="sidebar-sub-header"><a href="/posts/2019/SafeAccess.html#shortcomings" class="sidebar-link">Shortcomings</a></li><li class="sidebar-sub-header"><a href="/posts/2019/SafeAccess.html#your-possibilities-today" class="sidebar-link">Your possibilities today</a></li><li class="sidebar-sub-header"><a href="/posts/2019/SafeAccess.html#implementation-with-plain-javascript" class="sidebar-link">Implementation with plain JavaScript</a></li><li class="sidebar-sub-header"><a href="/posts/2019/SafeAccess.html#closing-words" class="sidebar-link">Closing words</a></li></ul></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="optional-chaining-or-safeaccess-for-javascript"><a href="#optional-chaining-or-safeaccess-for-javascript" aria-hidden="true" class="header-anchor">#</a> Optional Chaining or SafeAccess for JavaScript</h1> <p style="font-style:italic;color:#bbb;">Originally posted in 2019-03</p> <p>Let's discuss the concept of optional chaining in JavaScript. There is a <strong>tc39 proposal</strong> which we will take a brief look at. Then we will explore a few options you have to use this feature already today before it has become part of the standard. And lastly, we are going to implement it <strong>ourselves</strong>. But better! We will see that it is not always necessary to extend a language's standard because a lot of times, and with a little creativity, a feature can be implemented with already existing tools.</p> <h2 id="what-this-is-about"><a href="#what-this-is-about" aria-hidden="true" class="header-anchor">#</a> What this is about</h2> <p>Oftentimes, when accessing nested properties of JavaScript objects, you have to verify the existence of all properties leading up to the one you are looking for.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> street <span class="token operator">=</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">;</span>
</code></pre></div><p>If you don't and you hit an <code>undefined</code> halfway, you get a nasty error message which you probably know very well.</p> <div class="language- extra-class"><pre class="language-text"><code>Uncaught TypeError: Cannot read property 'address' of undefined
</code></pre></div><p>As of February 2019, there is a <a href="https://github.com/tc39/proposal-optional-chaining" target="_blank" rel="noopener noreferrer">Stage 1 proposal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that tries to combat this issue. The <strong>optional chaining operator</strong>. Depending on your preferred platform you may know it as <em>&quot;safe navigation operator&quot;</em>, <em>&quot;null-conditional operator&quot;</em> or perhaps <em>&quot;existential operator.&quot;</em> I have even heard it being called the <em>&quot;Elvis operator&quot;.</em> But that only seems to be used among Câ™¯ folks. Here it goes:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">?</span><span class="token punctuation">.</span>
</code></pre></div><p>The idea is that you can safely access an object's properties without that tedious validation and without being thrown exceptions at if things aren't were you expect them to be.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> maybeStreet <span class="token operator">=</span> user<span class="token operator">?</span><span class="token punctuation">.</span>address<span class="token operator">?</span><span class="token punctuation">.</span>street<span class="token punctuation">;</span>
</code></pre></div><p>If <code>user</code> or <code>address</code> is <code>undefined</code>, the result of the expression and therefore <code>maybeStreet</code> will be <code>undefined</code>. Makes things much shorter and readable.</p> <h2 id="shortcomings"><a href="#shortcomings" aria-hidden="true" class="header-anchor">#</a> Shortcomings</h2> <p>There are some shortcomings though. The main one I see is that we can't provide a default value for the case of unsuccessful access. The operator always defaults to <code>undefined</code>. So we still have to check whether our efforts of getting the value were actually successful or not. This requires us to assign an intermediary name even though we want to use the value right away. We don't need it to loiter around.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> maybeStreet <span class="token operator">=</span> user<span class="token operator">?</span><span class="token punctuation">.</span>address<span class="token operator">?</span><span class="token punctuation">.</span>street<span class="token punctuation">;</span>
<span class="token keyword">return</span> maybeStreet <span class="token operator">!==</span> undefined
    <span class="token operator">?</span> <span class="token function">fetchHousesOnStreet</span><span class="token punctuation">(</span>maybeStreet<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Compared to the old way:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> maybeStreet <span class="token operator">=</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">;</span>
<span class="token keyword">return</span> maybeStreet <span class="token operator">!==</span> undefined
    <span class="token operator">?</span> <span class="token function">fetchHousesOnStreet</span><span class="token punctuation">(</span>maybeStreet<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Not much of a difference. It's a bit more readable and a few characters shorter but the repetitive assign/null-check/perform pattern remains unchanged. Cold comfort.</p> <p>This pattern is ceremony that doesn't add to the expressivity of the code and it pollutes the current scope <em>and our brains</em> with temporary names. We should always strive for writing code that is as <strong>expressive</strong> and <strong>declarative</strong> as possible. It helps others and your future self to get an idea of <strong>what</strong> this code is doing instead of <strong>how</strong> it is doing things.</p> <p>As Eric Elliott put it in his excellent series on <a href="https://medium.com/javascript-scene/composing-software-an-introduction-27b72500d6ea" target="_blank" rel="noopener noreferrer">Composing Software<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <blockquote><p>More concise code expression leads to enhanced comprehension. Some code gives us useful information, and some code just takes up space.</p></blockquote> <p>Go check it out!</p> <p>To improve the expressivity of the example above let's ask ourselves <strong>what</strong> we actually want to do here.</p> <p><em>Call <code>fetchHousesOnStreet</code> on <code>user.address.street</code> if <code>street</code> is there, otherwise return a rejected Promise.</em></p> <p>Agree? Good! Now let's see what the code is telling us:</p> <ul><li>get <code>user.address.street</code> and store in <code>maybeStreet</code></li> <li>check if <code>maybeStreet</code> has a useful value</li> <li>if it has, call <code>fetchHousesOnStreet</code></li> <li>otherwise reject</li></ul> <p>Too much information! Getting the value in a separate step and checking if we were successful are way too trivial to concern ourselves with. Let's get rid of them.</p> <p>Now we could make <code>fetchHousesOnStreet</code> handle the check for <code>undefined</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fetchHousesOnStreet</span><span class="token punctuation">(</span>maybeStreet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>maybeStreet <span class="token operator">===</span> undefined<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// actual implementation</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Then we could use it like this.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token function">fetchHousesOnStreet</span><span class="token punctuation">(</span>user<span class="token operator">?</span><span class="token punctuation">.</span>address<span class="token operator">?</span><span class="token punctuation">.</span>street<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Looks quite good. Problem is, to use this pattern the ceremonial check must now be placed in <strong>every single function</strong> that shall have this behaviour. We just relocated the unwanted check and are now polluting our functions with that ceremony. These functions can no longer exclusively focus on their actual task. In other words, they can no longer trust their input. This is actually worse than the first pattern. And thinking about refactoring this.... Let's try something else.</p> <p>What about this?</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token function">fetchHousesOnStreet</span><span class="token punctuation">(</span>user<span class="token operator">?</span><span class="token punctuation">.</span>address<span class="token operator">?</span><span class="token punctuation">.</span>street <span class="token operator">||</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Well, this works only if we consider all falsey values to be invalid. The empty string might be reasonably invalid in this very example but if we are, for instance, dealing with numeric values, <code>0</code> is very likely to be valid and shouldn't be replaced by the default value.</p> <p>This isn't getting us anywhere. It seems we would have to introduce more utilities to make safe member access work <strong>and</strong> eliminate noisy null-checks.</p> <p>So the proposed optional chaining operator simplifies only part of a common pattern. It is therefore questionable if it is worth introducing new syntax and making the learning curve steeper for beginners. Changing the standard should imply a considerable leap, not just a half-hearted tiny step. Because once it's in the standard, it's hard to get it out again.</p> <p><strong>Now let's check out some possibilities we have today and how they are dealing with these shortcomings.</strong></p> <h2 id="your-possibilities-today"><a href="#your-possibilities-today" aria-hidden="true" class="header-anchor">#</a> Your possibilities today</h2> <h3 id="babel"><a href="#babel" aria-hidden="true" class="header-anchor">#</a> Babel</h3> <p>Babel has an <a href="https://babeljs.io/docs/en/babel-plugin-proposal-optional-chaining" target="_blank" rel="noopener noreferrer">experimental plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that enables you to use optional chaining as it is proposed. That means you still have to deal with noisy null-checks. And a transpiler. If you already have a build apparatus in place, it's probably super easy to implement. I'd rather do without.</p> <h3 id="lodash"><a href="#lodash" aria-hidden="true" class="header-anchor">#</a> Lodash</h3> <p><a href="https://lodash.com/docs/4.17.11#get" target="_blank" rel="noopener noreferrer">Lodash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> offers the <code>get</code> function:</p> <div class="language-js extra-class"><pre class="language-js"><code>_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> path<span class="token punctuation">,</span> <span class="token punctuation">[</span>defaultValue<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>It goes like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>

_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> <span class="token string">&quot;a[0].b.c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span>

_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> <span class="token string">&quot;a.b.c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// undefined</span>

_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> <span class="token string">&quot;a.b.c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;default&quot;</span>

_<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> <span class="token string">&quot;a[0].b.foo&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;bar&quot;</span>
</code></pre></div><p>Here you specify your path to the desired property with a string. You can also optionally specify a default value. And it certainly does the job. Of course it  also works for safely invoking functions when we provide a no-op as the default value.</p> <p>I just don't get warm with providing an array or a string as the path to the required property. Feels unwieldy and unnatural. The refactoring experience isn't too nice either.</p> <h3 id="ramda"><a href="#ramda" aria-hidden="true" class="header-anchor">#</a> Ramda</h3> <p>Then there are <a href="https://ramdajs.com/docs/#path" target="_blank" rel="noopener noreferrer">Ramda<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>'s <code>path</code> and <code>pathOr</code>.</p> <p>This solution works about the same as Lodash's. The most prominent difference is the inverted order of arguments. While Lodash takes the object first, Ramda takes it last. Similarly, the default value comes first instead of last.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> object<span class="token punctuation">)</span>
<span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">pathOr</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">,</span> path<span class="token punctuation">,</span> object<span class="token punctuation">)</span>
</code></pre></div><p>Lodash's approach makes sense if you think of a default value as optional. But usually it is better to explicitly state what you want to do and avoid optional arguments. It makes your intent more obvious and therefore reduces chances of people (including your future self) unfamiliar with your code wondering whether you forgot to provide a default value in one place when you provided one in all other places. This can't happen with Ramda's distinction between <code>path</code> and <code>pathOr</code>.</p> <p>But more important is that the object to work on is provided last. This makes it very easy to partially apply the function and reuse it. When used frequently, it is the object that is the most likely to change. So it makes sense to take it last with less volatile arguments being stored for reuse. With Ramda's built-in currying you can do</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> getStreet <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">.</span><span class="token function">pathOr</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`N/A`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token string">`address`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`street`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> streets <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getStreet<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It is much more likely that you access the same property of hundreds of objects than accessing a hundred properties of only one object.</p> <p>With Lodash you would have to write</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">getStreet</span> <span class="token operator">=</span> obj <span class="token operator">=&gt;</span> _<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`address.street`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`N/A`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> streets <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getStreet<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Altogether Ramda is with its parameter ordering and its built-in currying more composition-friendly and thus allows for a nicer functional programming experience.</p> <h3 id="sanctuary"><a href="#sanctuary" aria-hidden="true" class="header-anchor">#</a> Sanctuary</h3> <p>One more library I would like to mention is <a href="https://github.com/sanctuary-js/sanctuary" target="_blank" rel="noopener noreferrer">Sanctuary<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Its approach is similar to that of Ramda and it has all of its benefits. One big bonus you get on top is that it eliminates the need to check for <code>undefined</code> after operations that can fail. How does it do it?</p> <p>It wraps results of such operations in a container called <strong>Maybe</strong> which has two possible states: <code>Nothing</code> meaning no valid value is contained, and <code>Just</code> with the requested result inside. The effect is that the getter function <strong>always</strong> returns something that you can work with. There is no need to check for <code>undefined</code> or whatever. Ever! And to access the value that is <em>maybe</em> inside, you simply <code>map</code> over that container like you would map over an array. If you are not familiar with this kind of structure, you can indeed (as a start) think of it as an array that may have <em>one</em> or <em>zero</em> elements. But never more!</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Lemmy`</span></span><span class="token punctuation">,</span> address<span class="token punctuation">:</span> <span class="token punctuation">{</span> street<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Kilmister St`</span></span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> maybeStreet <span class="token operator">=</span> <span class="token constant">S</span><span class="token punctuation">.</span><span class="token function">gets</span> <span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">.</span><span class="token function">is</span> <span class="token punctuation">(</span>$<span class="token punctuation">.</span>String<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token string">`address`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`street`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment">// Just (&quot;Kilmister St&quot;)</span>

<span class="token constant">S</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">.</span>toUpper<span class="token punctuation">)</span> <span class="token punctuation">(</span>maybeStreet<span class="token punctuation">)</span>
<span class="token comment">// Just (&quot;KILMISTER ST&quot;)</span>

<span class="token keyword">const</span> maybeZip <span class="token operator">=</span> <span class="token constant">S</span><span class="token punctuation">.</span><span class="token function">gets</span> <span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">.</span><span class="token function">is</span> <span class="token punctuation">(</span>$<span class="token punctuation">.</span>Number<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token template-string"><span class="token string">`address`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`zip`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment">// Nothing</span>

<span class="token constant">S</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">.</span>show<span class="token punctuation">)</span> <span class="token punctuation">(</span>maybeZip<span class="token punctuation">)</span>
<span class="token comment">// Nothing</span>
</code></pre></div><p>Sanctuary takes an additional predicate to determine if the found property is actually to be returned. Here we check the type of the found property. Nice!</p> <p>Still, we have to provide the path to our property as an array of strings. Still feels unnatural. And refactoring support isn't that great. <a href="https://www.jetbrains.com/webstorm/" target="_blank" rel="noopener noreferrer">WebStorm<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, my favourite IDE, does a pretty good job in that it recognises the properties in the path string and renames them, but after all it's just a textual find-and-replace occasionally resulting in renamed values all over your project. If only we could use native member access kind of like so:</p> <div class="language-js extra-class"><pre class="language-js"><code>user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>toUpper<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`N/A`</span></span><span class="token punctuation">)</span>
</code></pre></div><h2 id="implementation-with-plain-javascript"><a href="#implementation-with-plain-javascript" aria-hidden="true" class="header-anchor">#</a> Implementation with plain JavaScript</h2> <p>Now it's time to build it ourselves! Let's summarise the requirements:</p> <ul><li>natively accessing an object's properties without verifying their existence</li> <li>no <em>Cannot access...</em> exceptions</li> <li>no intermediary variables</li> <li>no checking if a value was successfully retrieved</li> <li>function application being skipped automatically when value retrieval failed</li></ul> <p>Considering the requirements of directly accessing properties without ever throwing, and instead returning a <code>Maybe</code> container for our requested value, this is what it is going to look like:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">SafeAccess</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>address<span class="token punctuation">.</span>street
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fetchHousesOnStreet<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fromMaybe</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>First, we put the <code>user</code> object in the <code>SafeAccess</code> context which we are going to explore in a minute. This allows us to natively access any property no matter at what level of nesting. So it is perfectly fine to do something like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Lemmy`</span></span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> maybeStreet <span class="token operator">=</span> <span class="token function">SafeAccess</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>st <span class="token operator">=&gt;</span> st<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Usually, we would get the <em>Cannot access...</em> exception on trying to access <code>address</code> because there is no object at index 1 of the <code>users</code> array. Not so when in the <code>SafeAccess</code> context.</p> <p>Once we have reached the property we are looking for, we call <code>map</code>. We pass a function that will be applied to the property's value. That is, if there is one. Just like an array's <code>map</code> function it is only applied to elements that are actually in the array. As a result we receive a <code>Maybe</code> object that either contains the modified value or <em>Nothing</em>.</p> <p>Now if we are fine to work with a <code>Maybe</code> value, we can stop here and move on. If, however, we need an &quot;unboxed&quot; value, we can call <code>fromMaybe</code> to exit the <code>Maybe</code> context. But as there might be <em>Nothing</em> inside, we have to provide a default value. Otherwise we would be back to where we started checking for a value's existence.</p> <p>We also have the opportunity to exit the <em>Safe</em> context without mapping. To do so we call <code>fromSafe</code> on the property we want to return. Again, we need to provide default value.</p> <p>Here are a few samples to get familiar with <code>SafeAccess</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Lemmy`</span></span><span class="token punctuation">,</span> address<span class="token punctuation">:</span> <span class="token punctuation">{</span> street<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Kilmister St`</span></span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">SafeAccess</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name  <span class="token comment">// Safe(`Lemmy`)</span>
<span class="token function">SafeAccess</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">fromSafe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`default`</span></span><span class="token punctuation">)</span>  <span class="token comment">// `Lemmy`</span>
<span class="token function">SafeAccess</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">fromSafe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`default`</span></span><span class="token punctuation">)</span>  <span class="token comment">// `default`</span>
<span class="token function">SafeAccess</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address<span class="token punctuation">.</span>zip  <span class="token comment">// Safe(&lt;invalid&gt;)</span>
<span class="token function">SafeAccess</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address<span class="token punctuation">.</span>zip<span class="token punctuation">.</span><span class="token function">fromSafe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`default`</span></span><span class="token punctuation">)</span>  <span class="token comment">// `default`</span>

<span class="token keyword">const</span> safeUsers <span class="token operator">=</span> <span class="token function">SafeAccess</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>

safeUsers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>st <span class="token operator">=&gt;</span> st<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// Maybe(`LEMMY`)</span>
safeUsers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address<span class="token punctuation">.</span>zip<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>zip <span class="token operator">=&gt;</span> zip<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// Nothing</span>

<span class="token keyword">const</span> safeAddress <span class="token operator">=</span> safeUsers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address<span class="token punctuation">;</span>

safeAddress<span class="token punctuation">.</span>street<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>st <span class="token operator">=&gt;</span> st<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromMaybe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`default`</span></span><span class="token punctuation">)</span>  <span class="token comment">// `KILMISTER ST`</span>
safeAddress<span class="token punctuation">.</span>zip<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>zip <span class="token operator">=&gt;</span> zip<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromMaybe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`default`</span></span><span class="token punctuation">)</span>  <span class="token comment">// `default`</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">Wow!</p> <p>Did you notice that you can store a partly traversed path in a variable and continue later on? Of course you can pass those properties wrapped in their <em>Safe</em> context to functions, too. You can't do that with the libraries from the previous section.</p></div> <h3 id="is-this-magic"><a href="#is-this-magic" aria-hidden="true" class="header-anchor">#</a> Is this magic?</h3> <p>No. It's ES6. Nothing special going on, actually.</p> <p>Let's inspect how <code>SafeAccess</code> works. The core feature we need is <code>Proxy</code>. As we are also going to need a few helpers and shared references, we put everything in a module.</p> <p>First, here is the entire module. Take a look to get an overview of its workings. Afterwards, we are going to look at the individual parts.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// SafeAccess.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> SafeAccess<span class="token punctuation">;</span>


<span class="token keyword">const</span> invalid <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">function</span> <span class="token function">SafeAccess</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> lastProxyable <span class="token operator">=</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> undefined <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>o<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">===</span> map<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">map</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> lastProxyable<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">===</span> fromSafe<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">fromSafe</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> lastProxyable<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">const</span> nextVal <span class="token operator">=</span> o<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">===</span> invalid <span class="token operator">||</span> o <span class="token operator">===</span> lastProxyable <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">defined</span><span class="token punctuation">(</span>nextVal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>invalid<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> nextVal <span class="token operator">===</span> <span class="token template-string"><span class="token string">`object`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>nextVal<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            lastProxyable<span class="token punctuation">.</span>value <span class="token operator">=</span> nextVal<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>lastProxyable<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">map</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> lastProxyable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Maybe <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`./Maybe`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">===</span> invalid<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Maybe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> val <span class="token operator">=</span> o <span class="token operator">===</span> lastProxyable
        <span class="token operator">?</span> lastProxyable<span class="token punctuation">.</span>value
        <span class="token punctuation">:</span> o<span class="token punctuation">;</span>

    <span class="token keyword">return</span> f <span class="token operator">=&gt;</span> <span class="token function">Maybe</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">fromSafe</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> lastProxyable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> val <span class="token operator">=&gt;</span> o <span class="token operator">===</span> invalid
        <span class="token operator">?</span> val
        <span class="token punctuation">:</span> o <span class="token operator">===</span> lastProxyable
            <span class="token operator">?</span> lastProxyable<span class="token punctuation">.</span>value
            <span class="token punctuation">:</span> o<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">defined</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">!==</span> undefined <span class="token operator">&amp;&amp;</span> a <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Number<span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>There is only one export: the <code>SafeAccess</code> function. It takes an object to be put in the <em>Safe</em> context, defines a handler config object to be used by a <code>Proxy</code> and eventually creates a <code>Proxy</code> with the received object and the handler.</p> <h3 id="the-handler"><a href="#the-handler" aria-hidden="true" class="header-anchor">#</a> The handler</h3> <p>The heart of a <code>Proxy</code> is of course its handler. Here, we define a trap for <code>get</code> operations. It receives the proxied object <code>o</code> and the property name <code>prop</code> being accessed. An example to illustrate this behaviour:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`bar`</span></span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>o<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo
<span class="token comment">// {foo: &quot;bar&quot;} &quot;foo&quot;  &lt;- logged</span>
<span class="token comment">// undefined           &lt;- returned value</span>
</code></pre></div><p>As expected, the proxied object <code>{ foo: &quot;bar&quot; }</code> and the accessed member <code>&quot;foo&quot;</code> are logged. Our <code>get</code> handler doesn't explicitly return anything, therefore we get <code>undefined</code>.</p> <p>There are three main ways our <code>get</code> handler can return. By the special property <code>map</code> which returns a function that, when called by the consumer, returns a <code>Maybe</code> object. By another special property <code>fromSafe</code> that returns a function which allows exiting the <em>Safe</em> context directly. Or, in any other case, by returning another <code>Proxy</code>.</p> <p>Note that it is our implementation that makes <code>map</code> and <code>fromSafe</code> special.</p> <p>Recursively returning another <code>Proxy</code> attached with the same handler enables the consumer to access object members at any depth. Only when accessing <code>map</code> or <code>fromSafe</code> it is possible to exit the <em>Safe</em> context and get a plain value.</p> <p>While traversing an object's members it is important that we keep track of the current state of validity. For this purpose there are <code>lastProxyable</code> and the module-scoped object <code>invalid</code>. Let's investigate the handler's recursive part first and see how these two objects work together.</p> <h4 id="three-proxies"><a href="#three-proxies" aria-hidden="true" class="header-anchor">#</a> Three Proxies</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> nextVal <span class="token operator">=</span> o<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">===</span> invalid <span class="token operator">||</span> o <span class="token operator">===</span> lastProxyable <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">defined</span><span class="token punctuation">(</span>nextVal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>invalid<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> nextVal <span class="token operator">===</span> <span class="token template-string"><span class="token string">`object`</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>nextVal<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

lastProxyable<span class="token punctuation">.</span>value <span class="token operator">=</span> nextVal<span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>lastProxyable<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>There are three branches that all return a new <code>Proxy</code>. This means that in the next iteration we will still be in the <em>Safe</em> context. The important difference is the object that we wrap in the <code>Proxy</code> before returning.</p> <p>Let's assume for now the user wants to access a valid property. The first condition evaluates to <code>false</code> and we skip to the second. We check if <code>nextVal</code> is of type <code>object</code>. This is important as <code>Proxy</code> cannot be applied to <strong>primitives</strong>! Now if the next value is an object, we can simply wrap it in another <code>Proxy</code> and carry on. That is the most trivial case.</p> <p>In case <code>nextVal</code> is NOT an object but a primitive, leading us to the third branch, we can't stick it in a <code>Proxy</code>. This would actually cause an exception! But one does not simply return a plain primitive and exit the <em>Safe</em> context either. The end of the context would be unpredictable for the user and it would thus totally defeat the purpose of <code>SafeAccess</code>.</p> <p>The solution is the <code>lastProxyable</code> object. As it is just a regular object, we can put it in a <code>Proxy</code>. We use it as a container for a non-proxyable primitive. At the same time it indicates your last chance to call <code>map</code> or <code>fromSafe</code> and get a value before going invalid.</p> <p>That being said, let's take a look at the first branch. We can see that trying to access the next value from <code>lastProxyable</code> results in an invalid result. Remember that <code>lastProxyable</code> was defined outside the <code>get</code> trap and that we just passed it to a <code>Proxy</code> in the previous iteration. <code>o</code> is exactly that object so we can do a convenient check for referential equality. On all further attempts to access another property, <code>o</code> will be <code>invalid</code>.</p> <p>For completeness' sake, we take a brief look at the last possibility resulting in an invalid result. And that is always when the accessed property's value is deemed not <code>defined</code>. This would typically be the case when the requested property does not exist on the preceding object.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">SafeAccess</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`foo`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar
<span class="token comment">// Safe(&lt;invalid&gt;)</span>
</code></pre></div><h4 id="the-way-out"><a href="#the-way-out" aria-hidden="true" class="header-anchor">#</a> The way out</h4> <p>As already stated above the only way out of the <em>Safe</em> context is via call to <code>map</code> or <code>fromSafe</code>. We have two dedicated checks in the <code>get</code> handler:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>o<span class="token punctuation">,</span> prop<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">===</span> map<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">map</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> lastProxyable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">===</span> fromSafe<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">fromSafe</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> lastProxyable<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We simply check if the specified property name matches either of the special functions and, if it does, delegate to the relevant one. Notice that <code>prop === map.name</code> is used instead of <code>prop === &quot;map&quot;</code>. This is a nice way to ensure that the names of the function and the public property representing it are always in sync. Whenever you rename the <code>map</code> function, the property name will reflect it automatically.</p> <h5 id="map"><a href="#map" aria-hidden="true" class="header-anchor">#</a> map</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">map</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> lastProxyable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Maybe <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`./Maybe`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">===</span> invalid<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Maybe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> val <span class="token operator">=</span> o <span class="token operator">===</span> lastProxyable
        <span class="token operator">?</span> lastProxyable<span class="token punctuation">.</span>value
        <span class="token punctuation">:</span> o<span class="token punctuation">;</span>

    <span class="token keyword">return</span> f <span class="token operator">=&gt;</span> <span class="token function">Maybe</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>map</code> takes the object <code>o</code> to be mapped over and the <code>lastProxyable</code> object. We import <code>Maybe</code>, a neighbouring module from the same repository <code>SafeAccess</code> is in. It's very small but we are skipping details here as it is not the focus of this post.</p> <p>If <code>o</code> turns out to be <code>invalid</code>, we immediately return a function that ignores its inputs and yields <em>Nothing</em> in the form of an empty <code>Maybe</code> object. This constitutes our requirement of skipping the mapping function when the <em>Safe</em> context is invalid.</p> <p>Remember that we are not mapping yet. We are producing the value for the property <code>map</code> on the proxied object. Therefore, we have to return a function in order to be able to call <code>map</code> from the outside:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">SafeAccess</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>mappingFunction<span class="token punctuation">)</span>
</code></pre></div><p>The next step, if <code>o</code> is not <code>invalid</code>, is to get the value to map over. In case we already arrived at <code>lastProxyable</code>, we have to unwrap it from the container that allowed us to apply <code>Proxy</code> even to primitives. Otherwise we just use whatever <code>o</code> is.</p> <p>Here too, we return a function yielding a <code>Maybe</code> object. This function takes the user-provided mapping function <code>f</code>, applies it to <code>val</code> and wraps the result in a <code>Maybe</code> object. Even though our value to map over is always valid at this point, we must wrap it in a <code>Maybe</code> to stay predictable in our results and not suddenly exit the context. Only this way the user can rest assured there will be a reliable result no matter what the outcome is.</p> <h5 id="fromsafe"><a href="#fromsafe" aria-hidden="true" class="header-anchor">#</a> fromSafe</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fromSafe</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> lastProxyable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> val <span class="token operator">=&gt;</span> o <span class="token operator">===</span> invalid
        <span class="token operator">?</span> val
        <span class="token punctuation">:</span> o <span class="token operator">===</span> lastProxyable
            <span class="token operator">?</span> lastProxyable<span class="token punctuation">.</span>value
            <span class="token punctuation">:</span> o<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>fromSafe</code> works in a very similar fashion to <code>map</code>. Same inputs. Returns a function.</p> <p>It has the purpose to exit the <em>Safe</em> context directly. As mentioned earlier, the user has to provide a default value. This is an important feature in order to avoid inconvenient <code>undefined</code> values being returned. Something the proposed optional chaining operator lacks entirely.</p> <p>The returned function's input <code>val</code> is the default value specified by the user. Whenever the object <code>fromSafe</code> was called on is invalid, that default value is returned. If the object is valid, just like in <code>map</code>, we return the relevant value considering it might be wrapped in <code>lastProxyable</code>.</p> <h2 id="closing-words"><a href="#closing-words" aria-hidden="true" class="header-anchor">#</a> Closing words</h2> <p>That's about it. We saw that JavaScript already has all it needs to make a smooth optional chaining experience and at the same time eliminate repetitive null-checks. No need to bloat the language standard with a lukewarm feature.</p> <p>What's worth considering, though, is having one <a href="https://github.com/tc39/proposal-javascript-standard-library" target="_blank" rel="noopener noreferrer">standard library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that encompasses these kind of things without messing with the syntax. <code>SafeAccess</code> and <code>Maybe</code> would be excellent candidates. Let's hope it will make it one day.</p> <p>You can find the source code for <code>SafeAccess</code> and <code>Maybe</code> on GitHub in a repository that collects various <em>utilities</em> that follow a <em>functional programming</em> approach. Appropriately named....</p> <div class="tip custom-block"><p class="custom-block-title">fUtility</p> <p><a href="https://github.com/ZabutonNage/fUtility" target="_blank" rel="noopener noreferrer">https://github.com/ZabutonNage/fUtility<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="tip custom-block"><p class="custom-block-title">Note</p> <p>This article refers to the initial version of <code>SafeAccess</code> <a href="https://github.com/ZabutonNage/fUtility/commit/c1240080f740fdc612c9de0e36c1890eb55efec1" target="_blank" rel="noopener noreferrer">c1240080<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
Meanwhile, it has been updated. Make sure to check out the latest version!</p></div> <p>So before hopping on the train for another lame feature proposal, do some experimenting. Try to find the JavaScript way! It's indeed fun and sometimes eye-opening! Many proposals, it seems, try to avoid exactly that and aim for allowing developers to stick with their non-JS habits.</p> <p>So don't waste your time on redundant proposals. Use it to discover the <strong>brilliance of JavaScript!</strong></p> <p>Peace! âœŒï¸</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/posts/2020/Backticks.html" class="prev">
          One Tick To Rule Them All
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.92f3002a.js" defer></script><script src="/assets/js/2.3bc359b4.js" defer></script><script src="/assets/js/7.fcc56a48.js" defer></script>
  </body>
</html>
